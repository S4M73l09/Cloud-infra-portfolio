<canvas class="ps4-flow-canvas" data-ps4-flow-canvas></canvas>

<script>
  const canvas = document.querySelector('[data-ps4-flow-canvas]');
  if (canvas instanceof HTMLCanvasElement) {
    const ctx = canvas.getContext('2d');
    if (ctx) {
      const motionReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      let width = 0;
      let height = 0;
      let t = 0;
      const dpr = Math.min(window.devicePixelRatio || 1, 2);

      const waves = [
        { y: 78, amp: 20, speed: 0.00016, freq: 0.00155, alpha: 0.42, thickness: 2.9, drift: 0.8 },
        { y: 108, amp: 28, speed: 0.00014, freq: 0.0012, alpha: 0.3, thickness: 2.3, drift: -1.1 },
        { y: 164, amp: 34, speed: 0.00012, freq: 0.00096, alpha: 0.2, thickness: 1.9, drift: 1.3 },
        { y: -132, amp: 40, speed: 0.0001, freq: 0.00082, alpha: 0.13, thickness: 1.7, drift: -0.9 },
        { y: -70, amp: 24, speed: 0.00018, freq: 0.0017, alpha: 0.16, thickness: 1.4, drift: 0.6 }
      ];

      const resize = () => {
        width = window.innerWidth;
        height = window.innerHeight;
        canvas.width = Math.floor(width * dpr);
        canvas.height = Math.floor(height * dpr);
        canvas.style.width = `${width}px`;
        canvas.style.height = `${height}px`;
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
      };

      const sample = (x, wave, time) => {
        const base = wave.y < 0 ? height + wave.y : wave.y;
        const phaseA = x * wave.freq + time * wave.speed;
        const phaseB = x * (wave.freq * 0.52) - time * wave.speed * 0.58;
        const phaseC = x * (wave.freq * 0.24) + time * wave.speed * 0.36;
        const major = Math.sin(phaseA) * wave.amp;
        const minor = Math.sin(phaseB) * (wave.amp * 0.42);
        const swell = Math.sin(phaseC + wave.drift) * (wave.amp * 0.24);
        const drift = Math.sin(time * 0.00018 + wave.drift) * 12;
        return base + major + minor + swell + drift;
      };

      const drawWave = (wave, time) => {
        const grad = ctx.createLinearGradient(0, 0, width, 0);
        grad.addColorStop(0, `rgba(170,220,255,${wave.alpha * 0.2})`);
        grad.addColorStop(0.5, `rgba(120,190,255,${wave.alpha})`);
        grad.addColorStop(1, `rgba(170,220,255,${wave.alpha * 0.2})`);
        ctx.strokeStyle = grad;
        ctx.lineWidth = wave.thickness;
        ctx.beginPath();
        const step = Math.max(10, Math.floor(width / 110));
        ctx.moveTo(-30, sample(-30, wave, time));
        for (let x = 0; x <= width + 30; x += step) {
          ctx.lineTo(x, sample(x, wave, time));
        }
        ctx.stroke();

        // Soft highlight pass for a PS3-like glossy ribbon look.
        ctx.strokeStyle = `rgba(215, 239, 255, ${wave.alpha * 0.2})`;
        ctx.lineWidth = Math.max(1, wave.thickness * 0.45);
        ctx.beginPath();
        ctx.moveTo(-30, sample(-30, wave, time) - wave.thickness * 0.8);
        for (let x = 0; x <= width + 30; x += step) {
          ctx.lineTo(x, sample(x, wave, time) - wave.thickness * 0.8);
        }
        ctx.stroke();
      };

      const draw = (time) => {
        t = time;
        ctx.clearRect(0, 0, width, height);
        waves.forEach((wave) => drawWave(wave, t));
        if (!motionReduced) {
          window.requestAnimationFrame(draw);
        }
      };

      resize();
      window.addEventListener('resize', resize);
      window.requestAnimationFrame(draw);
    }
  }
</script>
